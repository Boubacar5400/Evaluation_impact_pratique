install_github('andreacirilloac/updateR')
library(updateR)
install_github('andreacirilloac/updateR')
install.packages(c("MASS", "boot", "foreign", "lattice", "nlme", "nnet"))
install.packages("spatstat")
install.packages("spatstat")
library(spatstat)
help(spatstat)
spatstat.options(gcplib = TRUE)  # To enable gcplib allowed for non commercial use
data(swedishpines)   # Call the swedishpines data
X <- swedishpines
plot(X)
X  # information on the point pattern. Point patterns in spatstat are objects of class "ppp"
npoints(X)
marks(X)
coords(X)
as.owin(X)
as.data.frame(X)
marks(X) <- value
coords(X) <- value
X[W]
X[window]
fit <- ppm(X,~1, Strauss(9))   # Fit a Strauss process to the data
fit
plot(simulate(fit))  # Plot the simulated data with the process
plot(envelope(fit,Kest,nsim=39)) # Make a goodness of fit test for this fitted model
library(spatstat)
help(spatstat)
spatstat.options(gcplib = TRUE)  # To enable gcplib allowed for non commercial use
fit <- ppm(X,~1, Strauss(9))   # Fit a Strauss process to the data
fit
plot(simulate(fit))  # Plot the simulated data with the process
plot(envelope(fit,Kest,nsim=39)) # Make a goodness of fit test for this fitted model
3+2
x <- 5
?mean
??mean
list1 <- c(2,5.5,8,9)
age <- c(18, 27, 34, 18, 24, NA, 30, 28, 19, 19)
sexe <- c("F", "F", "M", "F", "M", "M", "M", "F", "M", "F")
sexe <- factor(sexe)
table(sexe)
mean(age)
mean(age, na.rm=T)
summary(age)
sd(age)
sd(age, na.rm=T)
sexe[3]
age[5]
age[c(1,3,6:8)]
is.na(age)
which(is.na(age))
base <- data.frame(age = age, sexe = sexe)
base[3,1]
base$age
base$age[3]
base$sexe == "F"
which(base$sexe == "F")
base$age[which(base$sexe == "F")]
mean(base$age[which(base$sexe == "F")])
base$sexe == "F"
which(base$sexe == "F")
base$age[which(base$sexe == "F")]
summary(base)
rm(list = ls())
budget_etat <- read.csv("~/Dropbox/Personal_files/en_cours/Enseignement/Agrosup/AGIR/Statistiques AGIR/Exemples R/2. ACP/budget_etat.csv", row.names=1, sep=";")
View(budget_etat)
View(budget_etat)
View(budget_etat)
base2 <- budget_etat[,1:11]
summary(base2)
boxplot(base2)
plot(ACS,DET,data=base2)
plot(base2$ACS,base2$DET)
plot(base2$ACS,base2$DET,
main  = "Action sociale versus dette",
xlabel = "Action sociale", ylabel =" Dette")
plot(base2$ACS,base2$DET,
main  = "Action sociale versus dette",
xlab = "Action sociale", ylab =" Dette")
plot(base2$ACS,base2$DET,
main  = "Action sociale versus dette",
xlab = "Action sociale", ylab =" Dette",
cex = 0.5)
install.packages("scatterplot3d")
library(scatterplot3d)
help(package = "scatterplot3d")
scatterplot3d(base2$ACS,base2$DET,base2$LOG)
pairs(base2)
pairs(base2)
pairs(base2,cex=0.5)
mat_cor <- cor(base2)
View(mat_cor)
install.packages("corrplot")
library(corrplot)
help(package = "corrplot")
corrplot(mat_cor)
corrplot(mat_cor, method = "square")
corrplot(mat_cor, method = "ellipse")
corrplot(mat_cor, method = "shade")
install.packages("FactoMineR")
library(FactoMineR)
help(package="FactoMineR")
res_ACP <- PCA(base2)
summary(res_ACP)
res_ACP$ind$dist
sort(res_ACP$ind$dist)
plot(res_ACP, choix = "ind", cex=0.5)
plot(res_ACP, choix = "ind", cex=0.5, axes = c(3,4))
plot(res_ACP, choix = "var", cex = 0.5)
plot(res_ACP, choix = "ind", col = "ACS", cex = 0.5)
?plot.PCA
plot(res_ACP, choix = "ind", col.hab = "ACS", cex = 0.5)
plot(res_ACP, choix = "ind", col.hab = "ACS", cex = 0.5)
plot(res_ACP, choix = "ind", habillage = "ACS", cex = 0.5)
plot(res_ACP, choix = "ind", habillage = "ANC", cex = 0.5)
res_ACP
library(readxl)
data_dep <- read_excel("Downloads/data_dep.xls")
View(data_dep)
data_dep$Dep. <- NULL
summary(data_dep)
library(FactoMineR)
res <- PCA(data_dep)
summary(res)
plot(res,cex = 0.5)
plot(res,cex = 0.5)
plot(res,choix = var, cex = 0.5)
plot(res,choix = "var", cex = 0.5)
summary(res)
res$ind$cos2
sort(res$ind$cos2[,1])
?sort
sort(res$ind$cos2[,1], decreasing= T)
sort(res$var$cos2[,1], decreasing= T)
sort(res$var$ontrib[,1], decreasing= T)
res$var$ontrib[,1]
sort(res$var$contrib[,1], decreasing= T)
summary(res)
sort(res$ind$cos2[,2], decreasing= T)
sort(res$var$cos2[,2], decreasing= T)
plot(res,choix = "var", cex = 0.5)
plot(res,cex = 0.5, axes = c(3,4))
plot(res,choix = "var", cex = 0.5, axes = c(3,4))
sort(res$ind$cos2[,3], decreasing= T)
sort(res$ind$cos2[,4], decreasing= T)
sort(res$var$cos2[,3], decreasing= T)
Creme <- read.csv("~/Dropbox/Personal_files/en_cours/Enseignement/Agrosup/AGIR/Statistiques AGIR/Exemples R/3. Classification/Creme.csv", row.names=1, sep=";")
View(Creme)
summary(Creme)
?ACP
?PCA
library(FactoMineR)
?PCA
res_ACP <- PCA(Creme, quali.sup=10:12)
summary(res_ACP)
res_ACP <- PCA(Creme, quali.sup=10:12, ncp = 7)
res_class <- HCPC(res_ACP)
summary(res_class)
res_class
res_class$desc.var
vente <- read.table(file.choose(), h = T)
attach(vente)
plot(annee,vente,type="p")
plot(annee,vente,type="p")
plot(Annee,Vente,type="p")
plot(Annee,Vente,type="p",pch="+",col="red")
plot(Annee,Vente,pch="+",col="red")
plot(Annee,Vente,pch="*",col="red")
?cor.test
cor.test(Annee,Vente,method="spearman")
?lm
res_lm <- lm(Vente ~ Annee)
abline(res_lm,col="blue")
summary(res_lm)
residuals(res_lm)
mean(residuals(res_lm))
pred_1995 <- 377077.36 -188.29 * 1995
pred_1995
newdata <- data.frame(Annee = 1995)
newdata <- data.frame(Annee = 1995)
predict(res_lm, newdata)
newdata <- data.frame(Annee = 1995)
predict(res_lm, newdata,interval="pred")
detach(vente)
detach(vente)
rm(list=ls())
manuel <- c(0.5, 0.98, 1.8, 2.21, 2.9, 3.9, 5.6)
calcule <- c(0.48, 0.99, 1.82, 2.23, 2.8, 4, 5.4)
dat <- data.frame(manuel,calcule)
rm(calcule,manuel)
manuel <- c(0.5, 0.98, 1.8, 2.21, 2.9, 3.9, 5.6)
calcule <- c(0.48, 0.99, 1.82, 2.23, 2.8, 4, 5.4)
dat <- data.frame(manuel,calcule)
rm(calcule,manuel)
attach(dat)
# Correlation et Graphique
cor.test(manuel,calcule)
plot(manuel,calcule)
res_lm <- lm(calcule ~ manuel)
abline(res_lm,col="blue")
summary(res_lm)
residuals(res_lm)
stat_test <- (0.97281 - 1)/0.02161
stat_test
detach(dat)
rm(list=ls())
# Rentrer les donnees
concentration <- c(1,1.5,2,2.5,3,3.5,4,5,6,7,9,10)
biomasse <- c(0.042,0.034,0.027,0.027,0.028,0.018,0.017,0.013,0.011,0.009,0.008)
biomasse <- c(0.042,0.034,0.027,0.027,0.028,0.018,0.017,0.013,0.013,0.011,0.009,0.008)
dat <- data.frame(concentration,biomasse)
rm(concentration,biomasse)
attach(dat)
plot(concentration,biomasse)
attach(dat)
u = 1/biomasse
dat$u = 1/biomasse
rm(u)
plot(u,biomasse)
attach(dat)
plot(u,biomasse)
plot(u,concentration)
plot(concentration,u)
res_lm <- lm(u ~ concentration)
abline(res_lm,col="blue")
summary(res_lm)
residuals(res_lm)
confint(res_lm)
newdata <- data.frame(concentration = 7.5)
predict(res_lm, newdata,interval="pred")
1/96.4746
rm(list = ls())
vente <- read.table(file.choose(), h = T)
attach(vente)
plot(Annee,Vente,pch="*",col="red")
?cor.test
cor.test(Annee,Vente,method="spearman")
res_lm <- lm(Vente ~ Annee)
summary(res_lm)
abline(res_lm, col ="blue")
residuals(res_lm)
3470-150.09091
mean(residuals(res_lm))
#377077.36 -188.29*x = 0
x = 377077.36/188.29
x
sum(residuals(res_lm)^2)
(1/8)*sum(residuals(res_lm)^2)
sqrt((1/8)*sum(residuals(res_lm)^2))
377077.36 -188.29*1995
newdata <- data.frame(Annee = 1995)
newdata <- data.frame(Annee = 1995)
predict(res_lm,newdata,interval="predict")
# Detacher les donnees
detach(vente)
rm(list=ls())
newdata <- data.frame(Annee = 1995)
rm(list=ls())
manuel <- c(0.5,0.98,1.8,2.21,2.9,3.9,5.6)
calcule <- c(0.48,0.99,1.82,2.23,2.8,4,5.4)
dat <- data.frame(manuel,calcule)
attach(dat)
rm(manuel,calcule)
manuel <- c(0.5,0.98,1.8,2.21,2.9,3.9,5.6)
calcule <- c(0.48,0.99,1.82,2.23,2.8,4,5.4)
dat <- data.frame(manuel,calcule)
attach(dat)
rm(manuel,calcule)
plot(manuel,calcule,pch="+",col="green")
res_lm <- lm(calcule ~ manuel)
summary(res_lm)
abline(res_lm, col ="red")
(0.97281 - 1)/0.02161
detach(dat)
rm(list=ls())
concentration <- c(1,1.5,2,2.5,3,3.5,4,5,6,7,9,10)
biomasse <- c(0.042,0.034,0.027,0.027,0.028,0.018,0.017,0.013,0.013,0.011,0.009,0.008)
dat <- data.frame(concentration,biomasse)
rm(concentration,biomasse)
# Graphique
plot(dat$concentration,dat$biomasse)
# Graphique
plot(dat$concentration,dat$biomasse,xlab = "Concentration",ylab="Biomasse")
plot(dat$concentration,dat$biomasse,xlab = "Concentration",ylab="Biomasse",
main = "Biomasse en fonction de la concentration")
# Changement de variable
dat$u <- a/dat$biomasse
# Changement de variable
dat$u <- 1/dat$biomasse
plot(dat$concentration,dat$u,xlab = "Concentration",ylab="Inverse de la biomasse",
main = "Inverse de la biomasse en fonction de la concentration")
res_lm <- lm(u ~ concentration, data = dat)
abline(res_lm, color="grey")
summary(res_lm)
abline(res_lm, color="red")
dat$u <- 1/dat$biomasse
plot(dat$concentration,dat$u,xlab = "Concentration",ylab="Inverse de la biomasse",
main = "Inverse de la biomasse en fonction de la concentration")
res_lm <- lm(u ~ concentration, data = dat)
abline(res_lm, color="red")
summary(res_lm)
abline(res_lm, col="red")
# Intervalle de confiance
confint(res_lm)
# Intervalle de confiance
confint(res_lm)
newdata <- data.frame(concentration = 7.5)
predict(res_lm,newdata,interval="predict")
1/96.4746
age <- c(35,40,43,45,50,55,58,60,65,70,75)
tension <- c(114,118,120,124,131,138,143,146,158,162,166)
dat <- data.frame(age,tension)
dat <- data.frame(age,tension)
attach(dat)  # met les variables de la base dat dans la memoire
summary(dat)
?cor
cor(dat)
# cor(age,tension)
cor.test(age,tension,method="pearson")
# cor(age,tension)
shapiro.test(age)
shapiro.test(tension)
cor.test(age,tension,method="pearson")
plot(age,tension)
plot(age,tension,col="red")
plot(age,tension,col="red",pch="+")
plot(age,tension,col="red",pch="*")
plot(age,tension,col="red",pch="*",, main="Relation entre âge et tension")
?lm
res_lm <- lm(tension ~ age)
abline(res_lm, col = "bleu")
summary(res_lm)
abline(res_lm, col = "blue")
shapiro.test(residuals(res_lm))
library(lmtest)
bptest(res_lm)
dwtest(res_lm)
summary(res_lm)
residuals(res_lm)
mean(residuals(res_lm))
# Detacher les données
detach(dat)
rm(list=ls())
vente <- read.table(file.choose(), h = T)
attach(vente)
plot(Annee,vente)
cor.test(Anne,vente,method="spearman")
# Corrélation et graphique
plot(Annee,Vente)
# Corrélation et graphique
plot(Annee,Vente,pch="*")
cor.test(Anne,Vente,method="spearman")
cor.test(Annee,Vente,method="spearman")
res_lm <- lm(Vente ~ Annee)
abline(res_lm, col = "red")
summary(res_lm)
377077.36 - 188.29 * 1995
newdata <- data.frame(Annee = 1995)
newdata <- data.frame(Annee = 1995)
predict(res_lm,newdata,interval="pred") # formule de l'intervalle de confiance en p. 13
predict(res_lm,newdata,interval="confidence")
carre <- read.table(file.choose(), h = T)
carre <- read.table(file.choose(), h = T)
summary(carre)
attach(carre)
# graphiques
boxplot(note ~ produit)
res_aov <- aov(note ~ produit + Error(degustateur + rang))
summary(res_aov)
68.56 + 36.16 + 146.16 + 12.48
146.16/263.36
68.56/263.36
12.48/263.36
library(agricolae)
library(agricolae)
install.packages("agricolae")
res_aov2 <- aov(note ~ produit + degustateur + rang)
# comme si les 3 facteurs étaient fixes et sans interaction
SNK.test(res_aov2,"produit")
SNK.test
res_aov2 <- aov(note ~ produit + degustateur + rang)
# comme si les 3 facteurs étaient fixes et sans interaction
res_snk - SNK.test(res_aov2,"produit")
SNK.test
res_aov2 <- aov(note ~ produit + degustateur + rang)
# comme si les 3 facteurs étaient fixes et sans interaction
res_snk <- SNK.test(res_aov2,"produit")
SNK.test
res_aov2 <- aov(note ~ produit + degustateur + rang)
# comme si les 3 facteurs étaient fixes et sans interaction
res_snk <- SNK.test(res_aov2,"produit")
res_snk
detach(carre)
rm(list = ls())
age <- c(35,40,43,45,50,55,58,60,65,70)
tension <- c(114,118,120,124,131,138,143,146,158,162)
age <- c(35,40,43,45,50,55,58,60,65,70,75)
tension <- c(114,118,120,124,131,138,143,146,158,162,166)
dat <- data.frame(age,tension)
co(age,tension)
cor(age,tension)
shapiro.test(age)
shapiro.test(tension)
cor.test(age,tension,method="pearson")
plot(age,tension,pch="*",col="pink")
plot(age,tension,pch="*",col="purple")
plot(age,tension,pch="*",col="purple", main = "Relation entre âge et tension")
res_lm <- lm(tension ~ age)
abline(res_lm,col="clear blue")
abline(res_lm,col="blue")
### Vérifier les hypothèses du modèle (p.9)
# normalité
shapiro.test(residuals(res_lm))
library(lmtest)
bptest(res_lm)
# Non autocorrélation
dwtest(res_lm)
# Summary
summary(res_lm)
?dwtest
install.packages("MatchIt")
rm(list=ls())
# The following packages must be installed
library(MatchIt)
library(dplyr)
library(ggplot2)
library(gridExtra)
# Read the data (set your wd first)
ecls <- read.csv("ecls.csv")
# Read the data (set your wd first)
ecls <- read.csv("ecls.csv")
setwd("~/Dropbox/Personal_files/en_cours/Enseignement/DASEE/EPP/Exercices/4. Matching")
# Read the data (set your wd first)
ecls <- read.csv("ecls.csv")
### Preliminary analysis on unmatched data
# Mean difference on the outcome variable
summary(ecls[ecls$catholic == 0, ])
summary(ecls[ecls$catholic == 1, ])
with(ecls, t.test(c5r2mtsc_std ~ catholic))
# Mean differences on the matching variables
ecls_cov <- c('race_white', 'p5hmage', 'w3income', 'p5numpla', 'w3momed_hsb')
lapply(ecls_cov, function(v) { t.test(ecls[, v] ~ ecls[, 'catholic'])})
### Estimation of the propensity score
# Estimation of a logit model
ecls$w3income_1k = ecls$w3income/1000
m_ps <- glm(catholic ~ race_white + w3income_1k + p5hmage + p5numpla + w3momed_hsb,
family = binomial(), data = ecls)
summary(m_ps)
# Computation of the propensity score
prs_df <- data.frame(pr_score = predict(m_ps, type = "response"),catholic = m_ps$model$catholic)
head(prs_df)
# Common support region
labs <- paste("Actual school type attended:", c("Catholic", "Public"))
prs_df$catholic = ifelse(prs_df$catholic == 1, labs[1], labs[2])
ggplot(prs_df, aes(x = pr_score)) + geom_histogram(color = "white") + facet_wrap(~catholic) + xlab("Probability of going to Catholic school") + theme_bw()
### Matching algorithm
# we remove missing values as MatchIt does not allow for missing values
summary(ecls[,ecls_cov])
ecls_nomiss <- ecls %>%
select(c5r2mtsc_std, catholic, one_of(ecls_cov)) %>%
na.omit()
summary(ecls_nomiss[,ecls_cov])
# Matching
mod_match <- matchit(catholic ~ race_white + w3income + p5hmage + p5numpla + w3momed_hsb,
method = "nearest", data = ecls_nomiss)
# Information on how successful the maching was
summary(mod_match)
plot(mod_match)
# Create a dataframe with only the matched observations
dta_m <- match.data(mod_match)
dim(dta_m)
### Covariate balance
# Visual inspection
fn_bal <- function(dta, variable) {
dta$variable <- dta[, variable]
if (variable == 'w3income') dta$variable <- dta$variable / 10^3
dta$catholic <- as.factor(dta$catholic)
support <- c(min(dta$variable), max(dta$variable))
ggplot(dta, aes(x = distance, y = variable, color = catholic)) +
geom_point(alpha = 0.2, size = 1.3) +
geom_smooth(method = "loess", se = F) +
xlab("Propensity score") +
ylab(variable) +
theme_bw() +
ylim(support)
}
grid.arrange(
fn_bal(dta_m, "w3income"),
fn_bal(dta_m, "p5numpla") + theme(legend.position = "none"),
fn_bal(dta_m, "p5hmage"),
fn_bal(dta_m, "w3momed_hsb") + theme(legend.position = "none"),
fn_bal(dta_m, "race_white"),
nrow = 3, widths = c(1, 0.8)
)
# Mean differences
dta_m %>%
group_by(catholic) %>%
select(one_of(ecls_cov)) %>%
summarise_all(funs(mean))
lapply(ecls_cov, function(v) { t.test(dta_m[, v] ~ dta_m$catholic)})
### Estimation of treatment effects
with(dta_m, t.test(c5r2mtsc_std ~ catholic))
lm_treat1 <- lm(c5r2mtsc_std ~ catholic, data = dta_m)
summary(lm_treat1)
lm_treat2 <- lm(c5r2mtsc_std ~ catholic + race_white + p5hmage +
I(w3income / 10^3) + p5numpla + w3momed_hsb, data = dta_m)
summary(lm_treat2)
ggplot(prs_df, aes(x = pr_score)) + geom_histogram(color = "white") + facet_wrap(~catholic) + xlab("Probability of going to Catholic school") + theme_bw()
m_ps <- glm(catholic ~ race_white + w3income_1k + p5hmage + p5numpla + w3momed_hsb,
family = binomial(), data = ecls)
summary(m_ps)
